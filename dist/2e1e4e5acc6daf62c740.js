(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{375:function(t,e,r){},402:function(t,e,r){"use strict";var i=r(375);r.n(i).a},424:function(t,e,r){"use strict";r.r(e);var i=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"edit-work"},[r("h3",{staticClass:"edit-work__title"},[t._v("Редактирование работы")]),r("form",{staticClass:"edit-work__block",on:{submit:function(e){return e.preventDefault(),t.savedWork(e)}}},[r("div",{staticClass:"edit-work__download"},[r("div",{staticClass:"edit-work__file"},[r("input",{staticClass:"edit-work__input",attrs:{type:"file",accept:"image/jpeg,image/png,image/jpg",id:"file"},on:{change:t.handleFile}}),t.errorPhoto?r("span",{staticClass:"edit-work__error"},[t._v(t._s(t.errorPhoto))]):t._e(),t.filePreview?r("div",{staticClass:"edit-work__drop",style:"backgroundImage: url("+t.filePreview+")"},[r("div",{staticClass:"edit-work__subs"},[t.filePreview?t._e():r("span",{staticClass:"edit-work__info"},[t._v("Перетащите или загрузите для загрузки изображения")]),r("label",{staticClass:"btn-default",attrs:{for:"file"}},[t._v("Загрузить")])])]):r("div",{staticClass:"edit-work__drop",style:"backgroundImage: url("+t.srcPhoto+")"},[r("div",{staticClass:"edit-work__subs"},[t.srcPhoto?t._e():r("span",{staticClass:"edit-work__info"},[t._v("Перетащите или загрузите для загрузки изображения")]),r("label",{staticClass:"btn-default",attrs:{for:"file"}},[t._v("Загрузить")])])])])]),r("div",{staticClass:"edit-work__form"},[r("div",{staticClass:"edit-block"},[r("div",{staticClass:"edit-block__field"},[r("Input",{attrs:{label:"Название",error:t.errorTitle},model:{value:t.work.title,callback:function(e){t.$set(t.work,"title",e)},expression:"work.title"}})],1),r("div",{staticClass:"edit-block__field"},[r("Input",{attrs:{label:"Ссылка",error:t.errorLink},model:{value:t.work.link,callback:function(e){t.$set(t.work,"link",e)},expression:"work.link"}})],1),r("div",{staticClass:"edit-block__field edit-block__field--textarea"},[r("Input",{attrs:{label:"Описание",type:"textarea",error:t.errorDescription},model:{value:t.work.description,callback:function(e){t.$set(t.work,"description",e)},expression:"work.description"}})],1),r("div",{staticClass:"edit-block__field"},[r("Input",{attrs:{label:"Теги",error:t.errorTechs},model:{value:t.work.techs,callback:function(e){t.$set(t.work,"techs",e)},expression:"work.techs"}})],1),r("div",{staticClass:"edit-block__tags"},[r("ul",{staticClass:"tags"},t._l(t.tagsList,function(e){return r("li",{staticClass:"tags__item"},[t._v(t._s(e)),r("button",{staticClass:"tags__delete",attrs:{type:"button"},on:{click:t.deleteTag}})])}),0)]),r("div",{staticClass:"edit-block__btns"},[r("button",{staticClass:"btn-zero",attrs:{type:"button"},on:{click:t.cancelEdit}},[t._v("Отмена")]),r("button",{staticClass:"btn-default"},[t._v("Сохранить")])])])])])])};i._withStripped=!0;var o=r(93),n=r(343);function s(t,e,r,i,o,n,s){try{var a=t[n](s),l=a.value}catch(t){return void r(t)}a.done?e(l):Promise.resolve(l).then(i,o)}function a(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},i=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(r).filter(function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable}))),i.forEach(function(e){l(t,e,r[e])})}return t}function l(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var c={props:{editWork:Object},data:function(){return{work:{title:"",photo:"",link:"",techs:"",description:""},filePreview:""}},computed:{tagsList:function(){if(this.work.techs&&""!==this.work.techs)return this.work.techs.split(",").filter(function(t){return t.trim()})},srcPhoto:function(){if(""!==this.work.photo)return"https://webdev-api.loftschool.com/"+this.work.photo},errorPhoto:function(){return this.validation.firstError("work.photo")},errorTitle:function(){return this.validation.firstError("work.title")},errorLink:function(){return this.validation.firstError("work.link")},errorDescription:function(){return this.validation.firstError("work.description")},errorTechs:function(){return this.validation.firstError("work.techs")}},methods:a({},Object(o.b)("works",["saveWork","updateWork"]),{cancelEdit:function(){this.validation.reset(),this.$emit("cancelEdit")},deleteTag:function(t){var e=new RegExp("".concat(t.target.parentElement.innerText,",? ?")),r=this.work.techs.replace(e,"");this.work.techs=r.replace(/,\s*$/,"")},savedWork:function(){var t,e=(t=regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.$validate();case 3:if(!t.sent){t.next=12;break}(e=new FormData).append("photo",this.work.photo),e.append("title",this.work.title),e.append("link",this.work.link),e.append("description",this.work.description),e.append("techs",this.work.techs),this.work.id?this.updateWork([this.work.id,e]):this.saveWork(e),this.cancelEdit();case 12:t.next=17;break;case 14:throw t.prev=14,t.t0=t.catch(0),new Error(t.t0.response.data.error||t.t0.response.data.message);case 17:case"end":return t.stop()}},t,this,[[0,14]])}),function(){var e=this,r=arguments;return new Promise(function(i,o){var n=t.apply(e,r);function a(t){s(n,i,o,a,l,"next",t)}function l(t){s(n,i,o,a,l,"throw",t)}a(void 0)})});return function(){return e.apply(this,arguments)}}(),handleFile:function(t){var e=this,r=this.fileFromForm(t);this.work.photo=r,this.renderFile(r).then(function(t){e.filePreview=t})},fileFromForm:function(t){var e=t.target.files||t.dataTransfer.files;if(!e.length)throw new Error("Нет файла");return e[0]},renderFile:function(t){var e=new FileReader;return new Promise(function(r){try{e.readAsDataURL(t),e.onloadend=function(){r(e.result)}}catch(t){throw new Error("Ошибка при чтении файла")}})}}),created:function(){this.editWork.id&&(this.work=a({},this.editWork))},components:{Input:function(){return r.e(1).then(r.bind(null,427))}},validators:{"work.photo":function(t){return n.Validator.value(t).required("Добавьте фото")},"work.title":function(t){return n.Validator.value(t).required("Заполните поле")},"work.link":function(t){return n.Validator.value(t).required("Заполните поле").url("Неверный формат url")},"work.description":function(t){return n.Validator.value(t).required("Заполните поле")},"work.techs":function(t){return n.Validator.value(t).required("Заполните поле")}}},u=(r(402),r(342)),d=Object(u.a)(c,i,[],!1,null,"b461cd38",null);d.options.__file="src/admin/components/blocks/WorkEdit.vue";e.default=d.exports}}]);